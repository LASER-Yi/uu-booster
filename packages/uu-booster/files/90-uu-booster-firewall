#!/bin/sh

# Check if uu zone already exists to avoid duplicate configuration
if uci get firewall.uu >/dev/null 2>&1; then
    echo "Firewall zone 'uu' already exists, skipping configuration..."
    exit 0
fi

# Add firewall zone named 'uu'
uci set firewall.uu='zone'
uci set firewall.uu.name='uu'
uci set firewall.uu.input='ACCEPT'
uci set firewall.uu.output='ACCEPT'
uci set firewall.uu.forward='ACCEPT'

# Add tun163 and tun164 interfaces to the zone
uci add_list firewall.uu.device='tun163'
uci add_list firewall.uu.device='tun164'

# Masquerading disabled (not setting masq='1' means it's off by default)

# Allow forwarding from lan to uu with label
uci set firewall.lan_to_uu='forwarding'
uci set firewall.lan_to_uu.name='lan_to_uu'
uci set firewall.lan_to_uu.src='lan'
uci set firewall.lan_to_uu.dest='uu'

# Allow forwarding from uu to lan with label
uci set firewall.uu_to_lan='forwarding'
uci set firewall.uu_to_lan.name='uu_to_lan'
uci set firewall.uu_to_lan.src='uu'
uci set firewall.uu_to_lan.dest='lan'

# Commit and reload firewall
uci commit firewall
/etc/init.d/firewall reload

exit 0
